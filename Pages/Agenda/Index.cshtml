@page

@using FrotiX.Repository.IRepository
@using Syncfusion.EJ2
@using Stimulsoft.Report.Mvc;
@using Syncfusion.EJ2.DropDowns
@using Syncfusion.EJ2.Navigations
@using Syncfusion.EJ2.Base
@using Syncfusion.EJ2.Popups
@using Kendo.Mvc.UI

@using FrotiX.Helpers;

@model FrotiX.Models.Agenda


@inject IUnitOfWork _unitOfWork



@{
	var Modalanimation = new Syncfusion.EJ2.Popups.DialogAnimationSettings { Effect = Syncfusion.EJ2.Popups.DialogEffect.None };
	var Okbutton = new
	{
		content = "Inserir Requisitante",
		isPrimary = true

	};
	var Closebutton = new
	{
		content = "Fechar",
		isPrimary = false
	};
}

@{

	@functions {

		public void OnGet()
		{
			FrotiX.Pages.Agenda.IndexModel.Initialize(_unitOfWork);
			ViewData["dataCombustivel"] = new ListaNivelCombustivel(_unitOfWork).NivelCombustivelList();
			ViewData["dataMotorista"] = new ListaMotorista(_unitOfWork).MotoristaList();
			ViewData["dataVeiculo"] = new ListaVeiculos(_unitOfWork).VeiculosList();
			ViewData["dataSetor"] = new ListaSetores(_unitOfWork).SetoresList();
			ViewData["dataRequisitante"] = new ListaRequisitante(_unitOfWork).RequisitantesList();
			ViewData["dataFinalidade"] = new ListaFinalidade(_unitOfWork).FinalidadesList();
			ViewData["dataEvento"] = new ListaEvento(_unitOfWork).EventosList();
			ViewData["dataSetorEvento"] = new ListaSetoresEvento(_unitOfWork).SetoresEventoList();
			ViewData["dataPeriodo"] = new ListaPeriodos().PeriodosList();
			ViewData["dataRecorrente"] = new ListaRecorrente().RecorrenteList();

			var listaOrigem = _unitOfWork.Viagem.GetAllReduced(selector: v => v.Origem)
				.Where(o => o != null)
				.Distinct()
				.OrderBy(o => o)
				.ToList();
			ViewData["ListaOrigem"] = listaOrigem;

			var listaDestino = _unitOfWork.Viagem.GetAllReduced(selector: v => v.Destino)
				.Where(d => d != null)
				.Distinct()
				.OrderBy(d => d)
				.ToList();
			ViewData["ListaDestino"] = listaDestino;

		}
	}
}

@{
	ViewData["Title"] = "Agenda";
	ViewData["PageName"] = "agenda_index";
	ViewData["Heading"] = "<i class='fad fa-calendar-alt'></i> Agenda: <span class='fw-300'>Agenda de Viagens</span>";
	ViewData["Category1"] = "Agenda";
	ViewData["PageIcon"] = "fad fa-calendar-alt";
}

@{

}


@section HeadBlock {

	<!-- FullCalendar -->
	<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
	@Html.Raw("<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.15/locales-all.global.min.js'></script>")

	<link rel="stylesheet" type="text/css" href="~/css/spinkit.css">

	<!-- Kendo UI CSS -->
	<link rel="stylesheet" href="https://kendo.cdn.telerik.com/themes/8.2.1/default/default-main.css" />

	<script src="https://kendo.cdn.telerik.com/2024.3.806/js/kendo.all.min.js"></script>

	<script src="https://cdn.kendostatic.com/2022.1.412/js/kendo.aspnetmvc.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.2.2/pdf.js"></script>
	<script>
		window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.2.2/pdf.worker.js';
	</script>
	
	<script src='https://unpkg.com/tooltip.js/dist/umd/tooltip.min.js'></script>

	<script src="~/js/cadastros/viagens.js"></script>

	<script>

		//Escolheu um Requisitante
		function RequisitanteValueChange() {

			var ddTreeObj = document.getElementById("lstRequisitante").ej2_instances[0];

			if (ddTreeObj.value === null || ddTreeObj.value === '') {
				return;
			}

			var requisitanteid = String(ddTreeObj.value);

			//debugger;

			//Pega Setor Padrão do Requisitante
			$.ajax({
				url: "/Viagens/Upsert?handler=PegaSetor",
				method: "GET",
				datatype: "json",
				data: { id: requisitanteid },
				success: function (res) {
					document.getElementById("ddtSetor").ej2_instances[0].value = [res.data];
				}
			});

			//Pega Ramal do Requisitante
			$.ajax({
				url: "/Viagens/Upsert?handler=PegaRamal",
				method: "GET",
				datatype: "json",
				data: { id: requisitanteid },
				success: function (res) {
					var ramal = res.data;
					var s = document.getElementById("txtRamalRequisitante");
					s.value = ramal;
				}
			});
		}



		//Escolheu um Motorista
		function MotoristaValueChange() {

			var ddTreeObj = document.getElementById("lstMotorista").ej2_instances[0];

			console.log("Objeto Requisitante: " + ddTreeObj);

			if (ddTreeObj.value === null || ddTreeObj.enabled === false)
			{
				return;
			}

			var motoristaid = String(ddTreeObj.value);
			return motoristaid;

		}

		//Escolheu um Veículo
		function VeiculoValueChange() {

			var ddTreeObj = document.getElementById("lstVeiculo").ej2_instances[0];

			console.log("Objeto Requisitante: " + ddTreeObj);

			if (ddTreeObj.value === null || ddTreeObj.enabled === false) {
				return;
			}

			var veiculoid = String(ddTreeObj.value);


			//Pega Km Atual do Veículo
			$.ajax({
				url: "/Viagens/Upsert?handler=PegaKmAtualVeiculo",
				method: "GET",
				datatype: "json",
				data: { id: veiculoid },
				success: function(res) {
					var km = res.data;
					var kmAtual = document.getElementById("txtKmAtual");
					kmAtual.value = km;
					//debugger;
				}
			});

		}


		//Escolheu um Requisitante no Evento
		function RequisitanteEventoValueChange() {

			var ddTreeObj = document.getElementById("lstRequisitanteEvento").ej2_instances[0];

			if (ddTreeObj.value === null || ddTreeObj.value === '') {
				return;
			}

			var requisitanteid = String(ddTreeObj.value);

			//debugger;

			//Pega Setor Padrão do Requisitante
			$.ajax({
				url: "/Viagens/Upsert?handler=PegaSetor",
				method: "GET",
				datatype: "json",
				data: { id: requisitanteid },
				success: function(res) {
					document.getElementById("lstSetorRequisitanteEvento").ej2_instances[0].value = [res.data];
				}
			});

		}

		// JavaScript function to handle DatePicker change event
		function onDateChange(args) {
			var selectedDates = args.model.values;

			// Get the ListBox element
			var listbox = document.getElementById('selectedDates');
			listbox.innerHTML = '';

			// Add each selected date to the ListBox
			selectedDates.forEach(function (date) {
				var li = document.createElement('li');
				li.textContent = new Date(date).toLocaleDateString();
				listbox.appendChild(li);
			});
		}

		function showDialogDiasSemana() {
			// Create a new instance of Syncfusion Dialog
			let dialog = new ej.popups.Dialog({
				header: '<div style="display: flex; align-items: center; justify-content: space-between;">' +
					'<i class="fa fa-exclamation-triangle" aria-hidden="true" style="color: #e67e22;"></i>' +
					'<span style="flex-grow: 1; text-align: center;">Dia da semana inconsistente</span>' +
					'<i class="fa fa-exclamation-triangle" aria-hidden="true" style="color: #e67e22;"></i>' +
					'</div>', content: '<div style="font-size: 1.1em; color: #555; line-height: 1.5;">' +
					'<p><i class="fa fa-calendar" aria-hidden="true" style="color: #3498db;"></i> O dia da semana da data inicial não corresponde a nenhum dos dias selecionados.</p>' +
					'<p><strong>O que deseja fazer?</strong></p>' +
					'</div>',
				showCloseIcon: true,
				closeOnEscape: false,
				isModal: true,
				position: { X: 'center', Y: 'center' },
				buttons: [
					{
						click: function () {
							// Handle "Ignorar" action
							dialog.hide();
						},
						buttonModel: {
							content: '<i class="fa-light fa-rocket-launch" aria-hidden="true"></i> Ignorar',
							isPrimary: true,
							cssClass: 'e-success custom-button'
						}
					},
					{
						click: function () {
							// Handle "Mudar Data Inicial" action
							document.getElementById('txtDataInicial').value = '';
							document.getElementById('txtDataInicial').focus();
							dialog.hide();
						},
						buttonModel: {
							content: '<i class="fa fa-calendar" aria-hidden="true"></i> Mudar Data Inicial',
							cssClass: 'e-warning custom-button'
						}
					},
					{
						click: function () {
							// Handle "Limpar Dias da Semana" action
							let diasSelect = document.getElementById('lstDias').ej2_instances[0];
							if (diasSelect instanceof ej.dropdowns.MultiSelect) {
								diasSelect.value = [];
							}
							dialog.hide();
						},
						buttonModel: {
							content: '<i class="fa-regular fa-broom-ball" aria-hidden="true"></i> Limpar Dias da Semana',
							cssClass: 'e-danger custom-button'
						}
					}
				],
				animationSettings: { effect: 'Zoom' },
				cssClass: 'custom-dialog',
				width: '450px',
				height: 'auto',
				visible: true,
				close: () => {
					dialog.destroy();
				}
			});

			// Append dialog to the specified container
			dialog.appendTo('#dialog-container-diassemana');
		}


		function onChangeCalendar(args) {
			var selectedDates = args.values.map(function(d) {
				var normalizedTimestamp = new Date(d).setHours(0, 0, 0, 0);
				return {
					Timestamp: normalizedTimestamp,
					DateText: formatDate(new Date(normalizedTimestamp)),
				};
			});
			selectedDates.sort(function(a, b) { return a.Timestamp - b.Timestamp; });
			listBox.dataSource = selectedDates;
			listBox.dataBind();
			updateBadge();
		}


		function onChange(args) {
			if (args.checked) {
				dialogObj.overlayClick = function() {
					dialogObj.hide();
				};
			} else {
				dialogObj.overlayClick = function() {
					dialogObj.show();
				};
			}
		}
		function dialogClose() {
			dialogBtn.style.display = 'block';
		}
		function dialogOpen() {
			dialogBtn.style.display = 'none';
		}
		function dlgButtonClick() {
			dialogObj.hide();
			// Adicione aqui a lógica para inserir o requisitante
		}
		function dlgButtonCloseClick() {
			dialogObj.hide();
		}

		function onBlurLstDias(args) {
			var diasSelecionados = document.getElementById("lstDias").ej2_instances[0].value;

			console.log("Blur event triggered");

			// Defensive check
			if (!diasSelecionados || diasSelecionados.length === 0) {
				console.warn("No days selected");
				return;
			}

			var dataInicialStr = $('#txtDataInicial').val();
			if (!dataInicialStr) {
				console.warn("No initial date provided");
				return;
			}

			console.log("Data Inicial String:", dataInicialStr);

			// Parse the date using Moment.js
			var dataInicial = moment(dataInicialStr, "DD/MM/YYYY", true);
			if (!dataInicial.isValid()) {
				console.error("Invalid date format:", dataInicialStr);
				return;
			}

			// Get the day of the week as an index (0 for Sunday, 1 for Monday, etc.)
			var diaSemanaDataInicial = dataInicial.day();
			console.log("Data Inicial Day of Week:", diaSemanaDataInicial);

			// Map the selected days to their indices
			var diasDaSemanaIndices = {
				"Sunday": 0,
				"Monday": 1,
				"Tuesday": 2,
				"Wednesday": 3,
				"Thursday": 4,
				"Friday": 5,
				"Saturday": 6
			};

			var diasSelecionadosIndices = diasSelecionados.map(function (dia) {
				return diasDaSemanaIndices[dia];
			});

			console.log("Dias Selecionados Indices:", diasSelecionadosIndices);

			if (!diasSelecionadosIndices.includes(diaSemanaDataInicial)) {
				showDialogDiasSemana();
			}
		}

		function onLstMotoristaCreated() {
			var combo = document.getElementById('lstMotorista').ej2_instances[0];

			combo.itemTemplate = function (data) {
				return '<div class="d-flex align-items-center">' +
					'<img src="' + (data.FotoBase64 || '/Images/barbudo.jpg') + '" alt="Foto" style="height:40px; width:40px; border-radius:50%; margin-right:10px;" />' +
					'<span>' + data.Nome + '</span>' +
					'</div>';
			};

			combo.valueTemplate = function (data) {
				if (!data) return '';
				return '<div class="d-flex align-items-center">' +
					'<img src="' + (data.FotoBase64 || '/Images/barbudo.jpg') + '" alt="Foto" style="height:30px; width:30px; border-radius:50%; margin-right:10px;" />' +
					'<span>' + data.Nome + '</span>' +
					'</div>';
			};
		}

		var dataFinalidade = @Html.Raw(Json.Serialize(ViewData["dataFinalidade"]));
		var dataPeriodo = @Html.Raw(Json.Serialize(ViewData["dataPeriodo"]));


	</script>

}
<!-- Bootstrap Datepicker CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/css/bootstrap-datepicker.min.css">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

@* <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" /> *@

<style>
	/* General Styles */
	body {
		font-family: "Poppins", sans-serif;
	}

	.fundo-ebony {
		background-color: #828E7B;
		color: white;
	}

	.fundo-cinza {
		background-color: #2F4F4F;
		color: aliceblue;
	}

	.fundo-laranja {
		background-color: #D2691E;
		color: white;
	}

	.form-control {
		height: calc(1.5em + 0.5rem + 2px);
		font-size: 0.875rem;
		line-height: 1.5;
		border-radius: 0.2rem;
		padding: 0.25rem 0.5rem;
	}

	.form-control-xs {
		font-size: 0.875rem;
		padding: 0.25rem 0.5rem;
	}

	.label {
		display: inline-block;
		margin-bottom: 0.5rem;
		font-weight: bold;
	}

	.input-group {
		display: flex;
		align-items: center;
	}

		.input-group .form-control {
			flex: 1;
		}

		.input-group .btn {
			margin-left: 0.5rem;
		}

	.e-btn-hide {
		display: none;
	}

	.dlgbtn {
		margin-right: 10px;
	}

	.esconde-diveventos {
		display: none;
	}

	.select-container {
		display: flex;
		gap: 20px;
		align-items: baseline;
	}

	.select-wrapper {
		display: flex;
		flex-direction: column;
	}

	.form-control.e-input {
		border: 1px solid #ced4da;
		border-radius: 0.375rem;
		padding: 0.375rem 0.75rem;
		box-shadow: none;
	}

		.form-control.e-input:focus {
			border-color: #86b7fe;
			outline: 0;
			box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
		}

	.container {
		display: flex;
		justify-content: center;
		align-items: flex-start;
		margin-top: 20px;
	}

	/* Badge Overlay */
	.badge-overlay {
		position: absolute;
		top: -10px;
		right: -10px;
		z-index: 2;
		font-size: 0.8rem;
		background-color: #e55b13;
		color: white;
		width: 35px;
		height: 35px;
		display: flex;
		justify-content: center;
		align-items: center;
		border-radius: 50%;
	}

	/* Remove Button */
	.remove-btn {
		background-color: red;
		color: white;
		border: none;
		border-radius: 50%;
		display: flex;
		justify-content: center;
		align-items: center;
		cursor: pointer;
		font-size: 1rem;
		width: 1.5em;
		height: 1.5em;
		line-height: 1.5em;
		padding-left: 0.8em; /* Ajuste o valor para mover o ícone um pouco para a direita */
	}

	.remove-btn i {
		font-size: 0.7rem;
	}

	.remove-btn:hover {
		background-color: darkred;
	}

	.normal-item {
		padding: 0.5rem;
		background-color: white;
		color: black;
		border-bottom: 1px solid #ccc;
		display: flex;
		align-items: center;
	}

		.normal-item:hover .item-text {
			color: darkred;
			font-weight: bold;
			font-size: 0.9rem;
		}

	/* Accordion Styles */
	.accordion-container {
		max-width: 700px;
		margin: 20px auto;
		padding: 15px;
		border: 1px solid #ccc;
		background-color: #f5f5f5;
		border-radius: 5px;
		display: none;
	}

		.accordion-container .form-group {
			margin-bottom: 1rem;
		}

			.accordion-container .form-group label {
				display: block;
				margin-bottom: 0.5rem;
				font-weight: bold;
			}

	.acoordion-container-setor,
	.accordion-container-requisitante {
		max-width: 450px;
		margin: 20px auto;
		padding: 15px;
		border: 1px solid #ccc;
		background-color: #f5f5f5;
		border-radius: 5px;
		display: none;
	}

		.acoordion-container-setor .form-group,
		.accordion-container-requisitante .form-group {
			margin-bottom: 1rem;
		}

			.acoordion-container-setor .form-group label,
			.accordion-container-requisitante .form-group label {
				display: block;
				margin-bottom: 0.5rem;
				font-weight: bold;
			}

	#txtRamalSetor {
		width: 100%;
	}

	#divRecorrencia {
		margin-bottom: 30px; /* Add margin to the row to add space */
	}

	#divFinalidadeOrigemDestino {
		margin-top: 20px; /* Add margin to the row to add space */
	}

	.calDatasSelecionadas-container {
		display: flex;
		justify-content: center;
		align-items: center;
	}

	.calendar-container {
		margin-right: 20px;
	}

	.listbox-container {
		position: relative;
		width: 250px;
		margin-top: 10px;
	}

	.e-calendar {
		font-family: "Poppins", sans-serif;
	}

	.modal-body {
		overflow-y: auto;
	}

	.row.align-baseline {
		align-items: baseline;
	}

	.row .col-12,
	.row .col-md-6,
	.row .col-md-4,
	.row .col-md-3 {
		padding-left: 15px;
	}

	.btn-nfs {
		background-color: #7B3F00 !important;
		color: white !important;
		cursor: pointer;
	}

	/* Button Hover Styles with 50% Lighter Background Colors */

	#btnViagem:hover {
		background-color: #EDA565 !important; /* 50% lighter version of #D2691E */
	}

	#btnConfirma:hover {
		background-color: #339af0 !important; /* Lighter version of Bootstrap primary */
	}

	#btnApaga:hover {
		background-color: #F08080 !important; /* Lighter version of Bootstrap danger */
	}

	#btnCancela:hover {
		background-color: #F08080 !important; /* Lighter version of Bootstrap danger */
	}

	#btnFecha:hover {
		background-color: #BEC8B4 !important; /* 50% lighter version of #828E7B */
	}

	#btnEvento:hover {
		background-color: #BEC8B4 !important; /* 50% lighter version for consistency */
	}

	#btnInserirEvento:hover {
		background-color: #339af0 !important; /* Lighter version of primary */
	}

	#btnFecharAccordionEvento:hover {
		background-color: #F08080 !important; /* Lighter version of danger */
	}

	#btnRequisitante:hover {
		background-color: #EDA565 !important; /* Lighter version of fundo-laranja */
	}

	#btnInserirRequisitante:hover {
		background-color: #339af0 !important; /* Lighter version of primary */
	}

	#btnFecharAccordionRequisitante:hover {
		background-color: #F08080 !important; /* Lighter version of danger */
	}

	#btnAbrirNovoSetor:hover {
		background-color: #BEC8B4 !important; /* Lighter version of fundo-ebony */
	}

	#btnInserirSetor:hover {
		background-color: #339af0 !important; /* Lighter version of primary */
	}

	#btnFecharAccordionSetor:hover {
		background-color: #F08080 !important; /* Lighter version of danger */
	}

	#lstRecorrente, #lstPeriodos, #calendarContainer, #listboxContainer {
		display: inline-flex;
		margin-right: 10px; /* Espaçamento entre os elementos, se necessário */
		align-items: center;
	}

	#btnAbrirNovoSetor {
		display: flex;
		align-items: center;
		justify-content: center;
		height: 100%;
		width: 42px; /* Adjust to match the desired height/width to make it square */
	}

	#btnRequisitante {
		display: flex;
		align-items: center;
		justify-content: center;
		height: 100%;
		width: 42px; /* Adjust to match the desired height/width to make it square */
	}

	#btnRequisitante.disabled {
		pointer-events: none;
		opacity: 0.6;
		cursor: default;
	}

	#btnEvento {
		display: flex;
		align-items: center;
		justify-content: center;
		height: 100%;
		width: 42px; /* Adjust to match the desired height/width to make it square */
	}

	.ml-2 {
		margin-left: 20px; /* Adjusts spacing between button and dropdown */
	}

	.custom-dialog-style .e-dlg-header {
		background-color: #007bff; /* Fundo azul para o cabeçalho */
		color: white; /* Cor do texto do cabeçalho */
	}

	.custom-dialog-style .e-dlg-content {
		background-color: #f9f9f9; /* Fundo suave para o conteúdo */
	}

	.custom-dialog-style .e-dlg-buttons {
		background-color: #f1f1f1; /* Fundo suave para os botões */
		padding: 10px; /* Espaçamento para os botões */
	}

	.custom-dialog-style .e-primary {
		background-color: #28a745; /* Cor do botão principal */
		color: white; /* Cor do texto do botão principal */
	}

	.e-warning-icon {
		font-size: 18px;
		color: #ffc107; /* Cor de aviso (amarelo) */
	}

	/* Remove hover effect from buttons */
	.btn:hover, .btn:focus, .btn:active {
		background-color: inherit !important;
		color: inherit !important;
	}

	/* Add space between FontAwesome icon and text */
	button i {
		margin-right: 8px; /* Adjust the value as needed for desired spacing */
	}

	/* Add some custom styles for better visual presentation */
	const styles = `
	.custom-dialog .e-dlg-header {
		background-color: #f39c12;
		color: white;
		font-weight: bold;
	}

	.custom-dialog .e-dlg-content {
		padding: 15px;
	}

	.e-dlg-buttons {
		text-align: center;
		display: flex;
		justify-content: center;
		gap: 10px;
	}

	.custom-button {
		font-weight: bold;
		border-radius: 5px;
		margin: 0;
	}

	.e-success.custom-button {
		background-color: #27ae60;
		color: white;
	}

	.e-warning.custom-button {
		background-color: #e67e22;
		color: white;
	}

	.e-danger.custom-button {
		background-color: #c0392b;
		color: white;
	}

		.e-success.custom-button:hover, .e-warning.custom-button:hover, .e-danger.custom-button:hover {
			opacity: 0.8;
		}

	`;

	// Append the custom styles to the document
	const styleSheet = document.createElement("style");
	styleSheet.type = "text/css";
	styleSheet.innerText = styles;
	document.head.appendChild(styleSheet);

	.swal2-container {
		z-index: 9999 !important; /* Ensure SweetAlert is on top */
		position: fixed !important;
	}

	.swal2-backdrop-show {
		z-index: 9998 !important; /* Backdrop just below the alert */
	}

	.modal-backdrop {
		z-index: 1040 !important; /* Keep Bootstrap backdrop below SweetAlert */
	}

	.label {
		line-height: 1.25; /* Ajuste conforme necessário */
	}

	.fa-arrows-spin {
		font-size: 1.25em;
	}

	/* Escopo: Apenas para o ComboBox com ID lstMotorista */
	#lstMotorista_popup .e-dropdownbase .e-list-item {
		min-height: 60px;
		display: flex;
		align-items: center;
		padding-left: 10px;
		transition: background-color 0.3s;
	}

		#lstMotorista_popup .e-dropdownbase .e-list-item img {
			height: 45px;
			width: 45px;
			object-fit: cover;
			border-radius: 50%;
			margin-right: 10px;
			transition: transform 0.3s ease;
		}

		#lstMotorista_popup .e-dropdownbase .e-list-item:hover {
			background-color: #f0f8ff;
		}

			#lstMotorista_popup .e-dropdownbase .e-list-item:hover img {
				transform: scale(1.2);
			}

	#lstMotorista .e-input-group .e-input,
	#lstMotorista .e-control-wrapper .e-input {
		display: flex;
		align-items: center;
	}

		#lstMotorista .e-input-group .e-input img,
		#lstMotorista .e-control-wrapper .e-input img {
			height: 30px;
			width: 30px;
			object-fit: cover;
			border-radius: 50%;
			margin-right: 8px;
		}

	#lstDiasCalendarioHTML {
		display: flex;
		flex-direction: column;
		align-items: center;
		text-align: center;
	}

	.e-tooltip-wrap.tooltip-laranja {
		background-color: #FFA500;
		color: #fff;
		border: 1px solid #cc8400;
		z-index: 1065 !important;
		position: absolute !important;
		box-shadow: 0 4px 8px rgba(0,0,0,0.2);
	}

		.e-tooltip-wrap.tooltip-laranja .e-tip-content,
		.e-tooltip-wrap.tooltip-laranja strong {
			color: #fff;
		}

	#modalViagens {
		z-index: 1050 !important;
	}

	/* Estilo base para todos os botões do modal footer */
	#divBotoes .btn {
		transition: background-color 0.2s ease, color 0.2s ease;
	}

	/* Botão Transforma em Viagem */
	#btnViagem {
		background-color: #D2691E;
		color: white;
	}

		#btnViagem:hover,
		#btnViagem:focus,
		#btnViagem:active {
			background-color: #EDA565 !important;
			color: white !important;
			box-shadow: none;
			outline: none;
		}

	/* Botão Confirmar */
	#btnConfirma {
		background-color: #0d6efd;
		color: white;
	}

		#btnConfirma:hover,
		#btnConfirma:focus,
		#btnConfirma:active {
			background-color: #339af0 !important;
			color: white !important;
			box-shadow: none;
			outline: none;
		}

	/* Botão Apagar */
	#btnApaga {
		background-color: #dc3545;
		color: white;
	}

		#btnApaga:hover,
		#btnApaga:focus,
		#btnApaga:active {
			background-color: #F08080 !important;
			color: white !important;
			box-shadow: none;
			outline: none;
		}

	/* Botão Cancelar */
	#btnCancela {
		background-color: #dc3545;
		color: white;
	}

		#btnCancela:hover,
		#btnCancela:focus,
		#btnCancela:active {
			background-color: #F08080 !important;
			color: white !important;
			box-shadow: none;
			outline: none;
		}

	/* Botão Fechar */
	#btnFecha {
		background-color: #828E7B;
		color: white;
	}

		#btnFecha:hover,
		#btnFecha:focus,
		#btnFecha:active {
			background-color: #BEC8B4 !important;
			color: white !important;
			box-shadow: none;
			outline: none;
		}

	.e-dropdownbase, .e-dropdowntree {
		margin-bottom: 0 !important;
	}

	.alinhar-vertical {
		align-items: center !important;
	}

	.e-dropdownbase, .e-combobox, .e-dropdowntree {
		min-height: 31px; /* ajuste para o seu design */
	}

	#ReportContainer {
		display: none;
		height: 0 !important;
		transition: height 0.2s;
	}

		#ReportContainer.visible {
			display: block;
			height: 200px !important;
		}

</style>




<div class="row" align="center">
	<div class="col-xl-12">
		<div id="panel-1" class="panel">
			<div class="panel-container show">
				<div class="panel-content ">
					<div id="loading " class="example">
						<div class="sk-chase">
							<div class="sk-chase-dot"></div>
							<div class="sk-chase-dot"></div>
							<div class="sk-chase-dot"></div>
							<div class="sk-chase-dot"></div>
							<div class="sk-chase-dot"></div>
							<div class="sk-chase-dot"></div>
						</div>
					</div>
					<div class="box-body">

						<br /><br />

						<div id='agenda'></div>

						<br /><br />
					</div>
				</div>
			</div>
		</div>
	</div>
</div>



@*Modal Agendamento/Viagens com ddTree funcionando*@
@*================================================*@

<div class="modal fade" id="modalViagens" role="dialog" data-bs-focus="false">
	<div class="modal-dialog modal-xl custom-modal-lg" style="max-width: 1100px;">
		<div class="modal-content">
			<div id="Titulo" class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<div id="divModal" class="modal-body">
				<div class="row align-baseline">
					<!-- Hidden Inputs -->
					<input id="txtReport" class="form-control form-control-xs" hidden="hidden" />
					<input id="txtViagemId" class="form-control form-control-xs" hidden="hidden" />
					<input id="txtRecorrenciaViagemId" class="form-control form-control-xs" hidden="hidden" />
					<input id="txtStatusAgendamento" class="form-control form-control-xs" hidden="hidden" />
					<input id="txtUsuarioIdCriacao" class="form-control form-control-xs" hidden="hidden" />
					<input id="txtDataCriacao" class="form-control form-control-xs" hidden="hidden" />

					<div id="dialogRecorrencia"></div>

					<!-- Ficha de Vistoria -->
					<div id="divNoFichaVistoria" class="col-12 col-md-2">
						<div class="form-group">
							<label class="label font-weight-bold">
								Nº Ficha Vistoria <i class="fa-solid fa-clipboard-list"></i>
							</label>
							<input id="txtNoFichaVistoria" class="form-control form-control-xs" />
						</div>
					</div>

					<!-- Date and Time Inputs -->
					<div class="col-6 col-md-2">
						<div class="form-group">
							<label class="label font-weight-bold">
								Data Inicial <i class="fa-solid fa-calendar-day"></i>
							</label>
							<input id="txtDataInicial" type="text">
						</div>
					</div>
					<div class="col-6 col-md-2">
						<div class="form-group">
							<label class="label font-weight-bold">
								Hora Início <i class="fa-solid fa-clock"></i>
							</label>
							<input id="txtHoraInicial" class="form-control form-control-xs" type="time" />
						</div>
					</div>
					<div class="col-6 col-md-2">
						<div id="divDataFinal" class="form-group">
							<label class="label font-weight-bold">
								Data Final <i class="fa-duotone fa-calendar-check"></i>
							</label>
							<input id="txtDataFinal" type="text">
						</div>
					</div>
					<div class="col-6 col-md-2">
						<div id="divHoraFinal" class="form-group">
							<label class="label font-weight-bold">
								Hora Fim <i class="fa-duotone fa-stopwatch"></i>
							</label>
							<input id="txtHoraFinal" class="form-control form-control-xs" type="time" />
						</div>
					</div>
					<div class="col-6 col-md-2">
						<div id="divDuracao" class="form-group">
							<label class="label font-weight-bold">
								Duração (hs) <i class="fa-duotone fa-hourglass-half"></i>
							</label>
							<ejs-numerictextbox id="txtDuracao" Enabled="false" format="n0" Readonly="true" showSpinButton="false"></ejs-numerictextbox>
						</div>
					</div>
				</div>

				<!-- Finalidade, Origem, Destino -->
				<div class="row align-baseline pb-5" id="divFinalidadeOrigemDestino">
					<div class="col-4 col-md-3">
						<div class="form-group">

							<div class="d-flex flex-column ml-2">
								<div class="d-flex align-items-center mb-1">
									<label for="lstFinalidade" class="label mr-2 mb-0">Finalidade</label>
									<i class="fa-duotone fa-solid fa-rectangle-history-circle-user" style="font-size: 1.25em; cursor: pointer;"></i>
								</div>
								<!-- DropDownTree Control -->
								<div id="lstFinalidade"></div>
							</div>

						</div>
					</div>
					<div class="col-4 col-md-3">
						<div class="form-group">

							<div class="d-flex flex-column ml-2">
								<div class="d-flex align-items-center mb-1">
									<label for="cmbOrigem" class="label mr-2 mb-0">Origem</label>
									<i class="fa-duotone fa-solid fa-map-location" style="font-size: 1.25em; cursor: pointer;"></i>
								</div>
								@* <input id="txtOrigem" class="form-control form-control-xs" /> *@
								<ejs-combobox id="cmbOrigem"
											  dataSource="@ViewData["ListaOrigem"]"
											  placeholder="Selecione ou digite a origem"
											  allowFiltering="true"
											  filterType="Contains"
											  allowCustom="true"
											  popupHeight="220px">
								</ejs-combobox>
							</div>

						</div>
					</div>
					<div class="col-4 col-md-3">
						<div class="form-group">

							<div class="d-flex flex-column ml-2">
								<div class="d-flex align-items-center mb-1">
									<label for="txtDestino" class="label mr-2 mb-0">Destino</label>
									<i class="fa-duotone fa-solid fa-map-location-dot" style="font-size: 1.25em; cursor: pointer;"></i>
								</div>
								@* <input id="txtDestino" class="form-control form-control-xs" /> *@
								<ejs-combobox id="cmbDestino"
											  dataSource="@ViewData["ListaDestino"]"
											  placeholder="Selecione ou digite o destino"
											  allowFiltering="true"
											  filterType="Contains"
											  allowCustom="true"
											  popupHeight="220px">
								</ejs-combobox>
							</div>

						</div>
					</div>
				</div>




				<!-- Evento Section -->
				<div class="row align-baseline">
					<div id="divEvento" class="row esconde-diveventos">
						<div id="ControlRegion" class="col-8 col-md-8 d-flex align-items-center">
							<!-- Container for the Dropdown -->
							<div class="form-group flex-grow-1">
								<label class="label">Nome do Evento</label>
								<!-- DropDownTree Control -->
								<ejs-dropdowntree id="lstEventos" placeholder="Selecione um Evento..." showCheckBox="false" allowMultiSelection="false" allowFiltering="true" filterType="Contains" filterBarPlaceholder="Procurar..." popupHeight="200px">
									<e-dropdowntree-fields dataSource="@ViewData["dataEvento"]" value="EventoId" text="Evento"></e-dropdowntree-fields>
								</ejs-dropdowntree>
							</div>
							<!-- Button for Event -->
							<div class="ml-2 d-flex align-items-center" style="height: 100%;">
								<a class="btn btn-nfs d-flex align-items-center justify-content-center" id="btnEvento" style="width: 35px; height: 35px;">
									<i class="fa-light fa-calendar-users"></i>
								</a>
							</div>
						</div>
						<div id="accordionEvento" class="accordion-container">
							<e-accordion>
								<e-accordion-items>
									<e-accordion-item expanded="true" header="Inserir um novo Evento">
										<ng-template #content>
											<form id="frmEvento">
												<div class="row">
													<div class="col-10">
														<div class="form-group">
															<label class="label font-weight-bold">Nome do Evento</label>
															<input id="txtNomeDoEvento" class="form-control form-control-xs" />
														</div>
													</div>
												</div>
												<div class="row">
													<div class="col-10">
														<div class="form-group">
															<label class="label font-weight-bold">Descrição do Evento</label>
															<input id="txtDescricaoEvento" class="form-control form-control-xs" />
														</div>
													</div>
												</div>
												<br />
												<div class="row">
													<div class="col-4">
														<div class="form-group">
															<label class="label font-weight-bold">Data Inicial</label>
															<input id="txtDataInicialEvento" class="form-control form-control-xs" type="date" />
														</div>
													</div>
													<div class="col-4">
														<div class="form-group">
															<label class="label font-weight-bold">Data Final</label>
															<input id="txtDataFinalEvento" class="form-control form-control-xs" type="date" />
														</div>
													</div>
													<div class="col-4">
														<div class="form-group">
															<label class="label font-weight-bold">Quantidade de Pessoas</label>
															<input id="txtQtdPessoas" class="form-control form-control-xs" type="number" />
														</div>
													</div>
												</div>
												<div class="row">
													<div class="col-12 form-control-xs" style="margin: 10px; width: 400px;">
														<label class="label font-weight-bold">Requisitante</label>
														<ejs-dropdowntree id="lstRequisitanteEvento" placeholder="Selecione um Requisitante" showCheckBox="false" allowMultiSelection="false" allowFiltering="true" filterType="Contains" filterBarPlaceholder="Procurar..." popupHeight="500px" change="RequisitanteEventoValueChange">
															<e-dropdowntree-fields dataSource="@ViewData["dataRequisitante"]" value="RequisitanteId" text="Requisitante"></e-dropdowntree-fields>
														</ejs-dropdowntree>
													</div>
													<div class="row">
														<div class="col-12 form-control-xs" style="margin: 10px; width: 00px;">
															<label class="label font-weight-bold">Setor do Requisitante</label>
															<ejs-dropdowntree id="lstSetorRequisitanteEvento" allowFiltering="true" placeholder="Selecione um Setor..." sortOrder="Ascending" showCheckBox="false" allowMultiSelection="false" allowFiltering="true" filterType="Contains" filterBarPlaceholder="Procurar setor...">
																<e-dropdowntree-fields dataSource="@ViewData["dataSetor"]" value="SetorSolicitanteId" parentValue="SetorPaiId" hasChildren="HasChild" text="Nome" expanded="expanded"></e-dropdowntree-fields>
															</ejs-dropdowntree>
														</div>
													</div>
												</div>
												<br />
												<div class="modal-footer">
													<button id="btnInserirEvento" class="btn btn-primary" type="submit" value="SUBMIT">Inserir Evento</button>
													<button type="button" class="btn btn-danger" id="btnFecharAccordionEvento">Fechar</button>
												</div>
											</form>
										</ng-template>
									</e-accordion-item>
								</e-accordion-items>
							</e-accordion>
						</div>
					</div>
				</div>

				<!-- Motorista, Veículo, KM -->
				<div class="row align-baseline">
					<div class="col-4 col-md-4">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label id="lblMotorista" for="lstMotorista" class="label font-weight-bold mr-2" style="margin: 0;">Motorista</label>
								<i id="icoMotorista" class="fa-duotone fa-solid fa-person-biking" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<!-- ComboBox Control -->
							<ejs-combobox id="lstMotorista"
										  placeholder="Selecione um Motorista"
										  allowFiltering="true"
										  filterType="Contains"
										  popupHeight="200px"
										  width="100%"
										  showClearButton="true"
										  dataSource="@ViewData["dataMotorista"]"
										  created="onLstMotoristaCreated"
										  change="MotoristaValueChange">
								<e-combobox-fields text="Nome" value="MotoristaId"></e-combobox-fields>
							</ejs-combobox>
						</div>
					</div>
					<div class="col-4 col-md-4">

						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label for="lstVeiculo" class="label mr-2 mb-0">Veículo</label>
								<i class="fa-duotone fa-solid fa-truck-bolt" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<!-- ComboBox Control -->
							<ejs-combobox id="lstVeiculo" placeholder="Selecione um Veículo" allowFiltering="true" filterType="Contains" dataSource="@ViewData["dataVeiculo"]" popupHeight="200px" width="100%" showClearButton="true" change="VeiculoValueChange">
								<e-combobox-fields text="Descricao" value="VeiculoId"></e-combobox-fields>
							</ejs-combobox>
						</div>

					</div>
					<div class="col-4 col-md-4 d-flex align-items-start">
						<!-- Change to align-items-center -->
						<div class="form-group mr-2" id="divKmAtual">
							<label class="label">Km Atual</label>
							<i class="fa-duotone fa-solid fa-gauge" style="font-size: 1.25em; cursor: pointer;"></i>
							<input readonly id="txtKmAtual" class="form-control form-control-xs" />
						</div>
						<div class="form-group mr-2" id="divKmInicial">
							<label class="label">Km Inicial</label>
							<i class="fa-duotone fa-solid fa-gauge-max" style="font-size: 1.25em; cursor: pointer;"></i>
							<input id="txtKmInicial" class="form-control form-control-xs" />
						</div>
						<div class="form-group mr-2" id="divKmFinal">
							<label class="label">Km Final</label>
							<i class="fa-duotone fa-solid fa-gauge-min" style="font-size: 1.25em; cursor: pointer;"></i>
							<input id="txtKmFinal" class="form-control form-control-xs" />
						</div>
						<div class="form-group mr-2" id="divQuilometragem">
							<label class="label">Distância</label>
							<i class="fa-duotone fa-solid fa-road" style="font-size: 1.25em; cursor: pointer;"></i>
							<ejs-numerictextbox id="txtQuilometragem" Enabled="false" format="n0" Readonly="true" showSpinButton="false"></ejs-numerictextbox>
						</div>
					</div>

					<!-- Combustível -->
					<div class="row align-baseline pb-5">
						<div class="col-6 col-md-3">
							<div class="form-group" id="divCombustivelInicial">
								<label class="label">Combustível Inicial</label>
								<i class="fa-duotone fa-solid fa-gauge-circle-plus" style="font-size: 1.25em; cursor: pointer;"></i>
								<!-- DropDownTree Control -->
								<ejs-dropdowntree id="ddtCombustivelInicial" popupHeight="200px" showClearButton="true">
									<e-dropdowntree-fields dataSource="@ViewData["dataCombustivel"]" value="Nivel" text="Descricao" imageURL="Imagem"></e-dropdowntree-fields>
								</ejs-dropdowntree>
							</div>
						</div>
						<div class="col-6 col-md-3">
							<div class="form-group" id="divCombustivelFinal">
								<label class="label">Combustível Final</label>
								<i class="fa-duotone fa-solid fa-gauge-circle-minus" style="font-size: 1.25em; cursor: pointer;"></i>
								<!-- DropDownTree Control -->
								<ejs-dropdowntree id="ddtCombustivelFinal" popupHeight="200px" showClearButton="true">
									<e-dropdowntree-fields dataSource="@ViewData["dataCombustivel"]" value="Nivel" text="Descricao" imageURL="Imagem"></e-dropdowntree-fields>
								</ejs-dropdowntree>
							</div>
						</div>
					</div>


					<!-- ===================== REQUISITANTE E SETOR ========================= -->
					<div class="row align-items-center">
						<!-- Bloco Requisitante com botão grudado -->
						<div class="col-md-6">
							<div class="form-group">
								<div class="d-flex align-items-end">
									<!-- ComboBox + botão colado -->
									<div style="flex:1;">
										<div class="d-flex flex-column ml-2">
											<div class="d-flex align-items-center mb-1">
												<label for="lstRequisitante" class="label font-weight-bold mr-2" style="margin: 0;">Requisitante</label>
												<i class="fa-duotone fa-solid fa-person-simple" style="font-size: 1.25em; cursor: pointer;"></i>
											</div>
											<div class="d-flex flex-row align-items-end" style="gap: 6px;">
												<!-- ComboBox Syncfusion mantido -->
												<ejs-combobox id="lstRequisitante" placeholder="Selecione um Requisitante..." allowFiltering="true" filterType="Contains" dataSource="@ViewData["dataRequisitante"]" popupHeight="200px" width="350px" showClearButton="true" change="RequisitanteValueChange">
													<e-combobox-fields text="Requisitante" value="RequisitanteId"></e-combobox-fields>
												</ejs-combobox>
												<!-- Botão grudado à direita -->
												<a class="btn btn-nfs ml-0" id="btnRequisitante"><i class="fal fa-user-plus"></i></a>
											</div>
										</div>
									</div>
									<!-- Ramal ao lado, alinhado em coluna -->
									<div class="d-flex flex-column ml-2">
										<div class="d-flex align-items-center mb-1">
											<label class="label font-weight-bold mr-2" style="margin: 0;">Ramal</label>
											<i class="fa-duotone fa-phone-office" style="font-size: 1.25em; cursor: pointer;"></i>
										</div>
										<input id="txtRamalRequisitante" class="form-control form-control-xs" style="width: 100%;" />
									</div>
								</div>
							</div>
							<!-- Accordion do Requisitante mantido -->
							<div id="accordionRequisitante" class="accordion-container-requisitante">
								<e-accordion>
									<e-accordion-items>
										<e-accordion-item expanded="true" header="Inserir um novo Requisitante">
											<ng-template #content>
												<form id="frmRequisitante">
													<div class="row g-3 mb-3">
														<div class="col-3">
															<div class="form-group">
																<label for="txtPonto">Ponto</label>
																<input type="text" id="txtPonto" class="form-control" />
															</div>
														</div>
														<div class="col-9">
															<div class="form-group">
																<label for="txtNome">Nome do Requisitante</label>
																<input type="text" id="txtNome" class="form-control" />
															</div>
														</div>
													</div>
													<div class="row g-3 mb-3">
														<div class="col-md-4">
															<div class="form-group">
																<label for="txtRamal">Ramal</label>
																<input type="text" id="txtRamal" class="form-control" />
															</div>
														</div>
														<div class="col-md-8">
															<div class="form-group">
																<label for="txtEmail">Email</label>
																<input type="email" id="txtEmail" class="form-control" />
															</div>
														</div>
													</div>
													<div class="form-group">
														<label for="ddtSetorRequisitante">Setor do Requisitante</label>
														<ejs-dropdowntree id="ddtSetorRequisitante" placeholder="Selecione um Setor"
																		  sortOrder="Ascending" allowFiltering="true" filterType="Contains"
																		  filterBarPlaceholder="Procurar..." width="100%" change="MotoristaValueChange">
															<e-dropdowntree-fields dataSource="@ViewData["dataSetor"]"
																				   value="SetorSolicitanteId" text="Nome"
																				   parentValue="SetorPaiId" hasChildren="HasChild">
															</e-dropdowntree-fields>
														</ejs-dropdowntree>
													</div>
													<div class="d-flex justify-content-end">
														<button id="btnInserirRequisitante" class="btn btn-primary mr-2" type="submit">
															Inserir Requisitante
														</button>
														<button type="button" class="btn btn-danger" id="btnFecharAccordionRequisitante">
															Fechar
														</button>
													</div>
												</form>
											</ng-template>
										</e-accordion-item>
									</e-accordion-items>
								</e-accordion>
							</div>
						</div>
						<!-- Bloco Setor do Requisitante -->
						<div class="col-md-6">
							<div class="form-group">
								<div class="d-flex alinhar-vertical">
									<div class="flex-grow-1">
										<div class="d-flex flex-column">
											<div class="d-flex align-items-center mb-1">
												<label for="ddtSetor" class="label font-weight-bold mr-2" style="margin: 0;">Setor do Requisitante</label>
												<i class="fa-duotone fa-solid fa-building-user" style="font-size: 1.25em; cursor: pointer;"></i>
											</div>
											<!-- Syncfusion DropDownTree mantido -->
											<ejs-dropdowntree id="ddtSetor"
															  allowFiltering="true"
															  placeholder="Selecione um Setor..."
															  sortOrder="Ascending"
															  showCheckBox="false"
															  filterType="Contains"
															  filterBarPlaceholder="Procurar setor..."
															  width="450px">
												<e-dropdowntree-fields dataSource="@ViewData["dataSetor"]"
																	   value="SetorSolicitanteId"
																	   parentValue="SetorPaiId"
																	   hasChildren="HasChild"
																	   text="Nome"
																	   expanded="expanded">
												</e-dropdowntree-fields>
											</ejs-dropdowntree>
										</div>
									</div>
								</div>
							</div>
							<!-- Accordion de Setor está comentado como no original -->
						</div>
					</div>
					<!-- ===================== FIM REQUISITANTE E SETOR ========================= -->
				</div>

				<!-- Recorrente Section -->

				<div class="select-container" id="divRecorrencia">
					<!-- Recorrente Dropdown -->
					<div class="select-wrapper col-3">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label for="lstRecorrente" class="label mr-2 mb-0">Recorrente?</label>
								<i class="fa-duotone fa-solid fa-arrows-spin" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<input id="lstRecorrente" type="text" />
						</div>
					</div>

					<!-- Periodo Dropdown -->
					<div class="select-wrapper col-3" id="divPeriodo" style="display: none;">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label for="lstPeriodos" class="label mr-2 mb-0">Periodo</label>
								<i class="fa-duotone fa-solid fa-calendar-circle-exclamation" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<input id="lstPeriodos" type="text" />
						</div>
					</div>

					<div class="select-wrapper col-3" id="divTxtPeriodo" style="display: none;">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label for="txtPeriodos" class="label mr-2 mb-0">Periodo</label>
								<i class="fa-duotone fa-solid fa-calendar-circle-exclamation" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<input type="text" id="txtPeriodos" class="form-control" disabled />
						</div>
					</div>

					<!-- Dias da Semana MultiSelect -->
					<div class="select-wrapper col-3" id="divDias" style="display: none;">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label for="lstDias" class="label mr-2 mb-0">Dias da Semana</label>
								<i class="fa-duotone fa-solid fa-calendar-week" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<input type="text" id="lstDias" />
						</div>
					</div>

					<!-- Dia do Mês Dropdown using Syncfusion -->
					<div class="select-wrapper col-2" id="divDiaMes" style="display: none;">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label for="lstDiasMes" class="label mr-2 mb-0">Dia do Mês</label>
								<i class="fa-duotone fa-solid fa-calendar-clock" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<input id="lstDiasMes" />
						</div>
					</div>

					<!-- Data Final Input -->
					<div class="select-wrapper col-2" id="divFinalRecorrencia" style="display: none;">
						<label class="label">Data Final Recorrência</label>
						<!-- Input element for TextBox -->
						<input id="txtFinalRecorrencia" type="text">
						@* <div id="dialog-container-diassemana"></div> *@
					</div>

					<!-- Data Final Falsa Input -->
					<div class="select-wrapper col-3" id="divFinalFalsoRecorrencia" style="display: none;">
						<label class="label">Data Final Recorrência</label>
						<!-- Div que envolve o TextBox e o ícone -->
						<div style="position: relative; display: inline-block;">
							<!-- TextBox da Syncfusion -->
							<ejs-textbox id="txtDataFinalRecorrencia" cssClass="calendar-textbox"></ejs-textbox>
							<!-- Ícone de calendário do FontAwesome -->
							<i class="fa-solid fa-calendar" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;"></i>
						</div>
					</div>

					<!-- Calendar Control -->
					<div class="calendar-container" id="calendarContainer" style="display: none;">
						<div id="calDatasSelecionadas"></div>
					</div>

					<!-- ListBox Container -->
					<div class="listbox-container" id="listboxContainer" style="display: none;">
						<!-- Circular Badge Overlay -->
						<span id="itensBadge" class="badge badge-overlay">0</span>
						<!-- Card for ListBox -->
						<div class="card">
							<div class="card-header">Dias Selecionados</div>
							<div class="card-body">
								<div id="lstDiasCalendario"></div>
							</div>
						</div>
					</div>

					<!-- ListBox HTML Container -->
					<div id="listboxContainerHTML" style="display: none; border: 1px solid #ccc; width: 200px; padding: 10px;">
						<!-- Circular Badge Overlay -->
						<span id="itensBadgeHTML" class="badge badge-overlay" style="display: none">0</span>

						<!-- Card for ListBox -->
						<div>
							<div id="divDiasSelecionados" style="font-weight: bold; margin-bottom: 10px; text-align: center;">
								Dias Selecionados
							</div>
							<div id="lstDiasCalendarioHTML" style="height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 5px;"></div>
						</div>
					</div>
				</div>

				<br />
				<br />

				<!-- Rich Text Editor -->
				<div class="row">
					<div class="col-md-12 col-xl-10 control-section">
						<div class="control-wrapper">
							<div>

								<div class="d-flex flex-column ml-2">
									<div class="d-flex align-items-center mb-1">
										<label for="rteDescricao" class="label mr-2 mb-0">Descrição da Viagem (passageiros / carga)</label>
										<i class="fa-duotone fa-solid fa-typewriter" style="font-size: 1.25em; cursor: pointer;"></i>
									</div>
									<ejs-richtexteditor id="rteDescricao" toolbarClick="toolbarClick" locale="pt-BR" height="250px" created="onCreate">
										<e-richtexteditor-insertimagesettings saveUrl="api/Viagem/SaveImage" path="./DadosEditaveis/ImagensViagens/"></e-richtexteditor-insertimagesettings>
									</ejs-richtexteditor>
								</div>

							</div>
						</div>
					</div>
				</div>

				<!-- Report Container -->
				<div id="ReportContainer" style="display:none; height:0;">
					<div id="fichaReport" style="width:100%" class="pb-3"></div>
				</div>

				<!-- User Labels -->
				<div class="row">
					<div class="col-12">
						<div class="form-group">
							<label id="lblUsuarioAgendamento" class="font-weight-light d-block text-muted">
								<i class="fa-duotone fa-solid fa-user-clock"></i> <span>Agendado por:</span>
							</label>
							<label id="lblUsuarioCriacao" class="font-weight-light d-block text-muted">
								<i class="fa-sharp-duotone fa-solid fa-user-plus"></i> <span>Criado por:</span>
							</label>
							<label id="lblUsuarioFinalizacao" class="font-weight-light d-block text-muted">
								<i class="fa-duotone fa-solid fa-user-check"></i> <span>Finalizado por:</span>
							</label>
							<label id="lblUsuarioCancelamento" class="font-weight-light d-block text-muted">
								<i class="fa-duotone fa-regular fa-trash-can-xmark"></i> <span>Cancelado por:</span>
							</label>
						</div>
					</div>
				</div>

				<!-- Modal Footer -->
				<div class="modal-footer" id="divBotoes">
					<button id="btnViagem" type="button" class="btn btn-sm fundo-laranja">
						<i class="fa-regular fa-shuffle" aria-hidden="true"></i>&nbsp;Transforma em Viagem
					</button>
					<button id="btnConfirma" type="button" class="btn btn-sm btn-primary">
						<i class="fa fa-save" aria-hidden="true"></i>Confirmar
					</button>
					<button id="btnApaga" type="button" class="btn btn-sm btn-danger">
						<i class="fa-light fa-trash-can-undo" aria-hidden="true"></i>Apagar
					</button>
					<button id="btnCancela" type="button" class="btn btn-sm btn-danger">
						<i class="fa fa-ban" aria-hidden="true"></i>Cancelar
					</button>
					<button id="btnFecha" type="button" class="btn btn-sm fundo-ebony" data-bs-dismiss="modal">
						<i class="fa fa-times" aria-hidden="true"></i>Fechar
					</button>
				</div>
			</div>
		</div>
	</div>
</div>

@* <div class="modal fade" id="modalViagens" role="dialog" data-bs-focus="false">
	<div class="modal-dialog  modal-xl custom-modal-lg" style="max-width: 55vw;">
		<div class="modal-content">
			<!-- Cabeçalho do modal -->
			<div id="Titulo" class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<div id="divModal" class="modal-body">
				<!-- Inputs ocultos necessários para o JS -->
				<input id="txtReport" class="form-control form-control-xs" hidden="hidden" />
				<input id="txtViagemId" class="form-control form-control-xs" hidden="hidden" />
				<input id="txtRecorrenciaViagemId" class="form-control form-control-xs" hidden="hidden" />
				<input id="txtStatusAgendamento" class="form-control form-control-xs" hidden="hidden" />
				<input id="txtUsuarioIdCriacao" class="form-control form-control-xs" hidden="hidden" />
				<input id="txtDataCriacao" class="form-control form-control-xs" hidden="hidden" />

				<div id="dialogRecorrencia"></div>

				<!-- ========================== PRIMEIRA LINHA DE CONTROLES ========================= -->
				<div class="row align-items-end">
					<!-- Ficha de Vistoria -->
					<div id="divNoFichaVistoria" class="col-12 col-md-2">
						<div class="form-group">
							<label class="label font-weight-bold">
								Nº Ficha Vistoria <i class="fa-solid fa-clipboard-list"></i>
							</label>
							<input id="txtNoFichaVistoria" class="form-control form-control-xs" />
						</div>
					</div>
					<!-- Data Inicial -->
					<div class="col-6 col-md-2">
						<div class="form-group">
							<label class="label font-weight-bold">
								Data Inicial <i class="fa-solid fa-calendar-day"></i>
							</label>
							<input id="txtDataInicial" type="text" class="form-control form-control-xs" />
						</div>
					</div>
					<!-- Hora Inicial -->
					<div class="col-6 col-md-2">
						<div class="form-group">
							<label class="label font-weight-bold">
								Hora Início <i class="fa-solid fa-clock"></i>
							</label>
							<input id="txtHoraInicial" class="form-control form-control-xs" type="time" />
						</div>
					</div>
					<!-- Data Final -->
					<div class="col-6 col-md-2">
						<div id="divDataFinal" class="form-group">
							<label class="label font-weight-bold">
								Data Final <i class="fa-duotone fa-calendar-check"></i>
							</label>
							<input id="txtDataFinal" type="text" class="form-control form-control-xs" />
						</div>
					</div>
					<!-- Hora Final -->
					<div class="col-6 col-md-2">
						<div id="divHoraFinal" class="form-group">
							<label class="label font-weight-bold">
								Hora Fim <i class="fa-duotone fa-stopwatch"></i>
							</label>
							<input id="txtHoraFinal" class="form-control form-control-xs" type="time" />
						</div>
					</div>
					<!-- Duração -->
					<div class="col-6 col-md-2">
						<div id="divDuracao" class="form-group">
							<label class="label font-weight-bold">
								Duração (hs) <i class="fa-duotone fa-hourglass-half"></i>
							</label>
							<!-- Syncfusion NumericTextBox mantido -->
							<ejs-numerictextbox id="txtDuracao" Enabled="false" format="n0" Readonly="true" showSpinButton="false"></ejs-numerictextbox>
						</div>
					</div>
				</div>
				<!-- ==================== FIM PRIMEIRA LINHA ==================== -->
				<!-- =================== FINALIDADE, ORIGEM, DESTINO ================== -->
				<div class="row align-items-end pb-3" id="divFinalidadeOrigemDestino">
					<!-- Finalidade (Syncfusion DropDownTree mantido) -->
					<div class="col-4 col-md-3">
						<div class="form-group">
							<div class="d-flex flex-column ml-2">
								<div class="d-flex align-items-center mb-1">
									<label for="lstFinalidade" class="label mr-2 mb-0">Finalidade</label>
									<i class="fa-duotone fa-solid fa-rectangle-history-circle-user" style="font-size: 1.25em; cursor: pointer;"></i>
								</div>
								<ejs-dropdowntree id="lstFinalidade" showCheckBox="false" allowMultiSelection="false" allowFiltering="true" filterType="Contains" select="lstFinalidade_Change" popupHeight="200px" sortOrder="Ascending" showClearButton="true" change="lstFinalidade_Change" changeOnBlur="false">
									<e-dropdowntree-fields dataSource="@ViewData["dataFinalidade"]" value="FinalidadeId" text="Descricao"></e-dropdowntree-fields>
								</ejs-dropdowntree>
							</div>
						</div>
					</div>
					<!-- Origem (Syncfusion ComboBox mantido) -->
					<div class="col-4 col-md-3">
						<div class="form-group">
							<div class="d-flex flex-column ml-2">
								<div class="d-flex align-items-center mb-1">
									<label for="cmbOrigem" class="label mr-2 mb-0">Origem</label>
									<i class="fa-duotone fa-solid fa-map-location" style="font-size: 1.25em; cursor: pointer;"></i>
								</div>
								<ejs-combobox id="cmbOrigem"
											  dataSource="@ViewData["ListaOrigem"]"
											  placeholder="Selecione ou digite a origem"
											  allowFiltering="true"
											  filterType="Contains"
											  allowCustom="true"
											  popupHeight="220px">
								</ejs-combobox>
							</div>
						</div>
					</div>
					<!-- Destino (Syncfusion ComboBox mantido) -->
					<div class="col-4 col-md-3">
						<div class="form-group">
							<div class="d-flex flex-column ml-2">
								<div class="d-flex align-items-center mb-1">
									<label for="txtDestino" class="label mr-2 mb-0">Destino</label>
									<i class="fa-duotone fa-solid fa-map-location-dot" style="font-size: 1.25em; cursor: pointer;"></i>
								</div>
								<ejs-combobox id="cmbDestino"
											  dataSource="@ViewData["ListaDestino"]"
											  placeholder="Selecione ou digite o destino"
											  allowFiltering="true"
											  filterType="Contains"
											  allowCustom="true"
											  popupHeight="220px">
								</ejs-combobox>
							</div>
						</div>
					</div>
				</div>
				<!-- =================== FIM FINALIDADE, ORIGEM, DESTINO ================== -->
				<!-- ===================== SEÇÃO EVENTO ===================== -->
				<div class="row align-items-end" style="margin-bottom: 18px;">
					<div id="divEvento" class="col-12">
						<div class="d-flex flex-row align-items-end" style="gap: 16px;">
							<!-- Campo Evento (Syncfusion DropDownTree) -->
							<div class="form-group flex-grow-1 mb-0">
								<label class="label" for="lstEventos">Nome do Evento</label>
								<ejs-dropdowntree id="lstEventos"
												  placeholder="Selecione um Evento..."
												  showCheckBox="false"
												  allowMultiSelection="false"
												  allowFiltering="true"
												  filterType="Contains"
												  filterBarPlaceholder="Procurar..."
												  popupHeight="200px"
												  hidden = true>
									<e-dropdowntree-fields dataSource="@ViewData["dataEvento"]" value="EventoId" text="Evento"></e-dropdowntree-fields>
								</ejs-dropdowntree>
							</div>
							<!-- Botão para adicionar novo Evento -->
							<div class="mb-0">
								<a class="btn btn-nfs d-flex align-items-center justify-content-center" id="btnEvento" style="width: 38px; height: 38px;">
									<i class="fa-light fa-calendar-users"></i>
								</a>
							</div>
						</div>
						<!-- Accordion para Inserir Novo Evento (inicialmente oculto, mostre ao clicar no botão) -->
						<div id="accordionEvento" class="accordion-container mt-3">
							<e-accordion>
								<e-accordion-items>
									<e-accordion-item expanded="true" header="Inserir um novo Evento">
										<ng-template #content>
											<form id="frmEvento">
												<div class="row g-3 mb-3">
													<div class="col-md-8">
														<div class="form-group">
															<label class="label" for="txtNomeDoEvento">Nome do Evento</label>
															<input id="txtNomeDoEvento" class="form-control form-control-xs" />
														</div>
													</div>
													<div class="col-md-4">
														<div class="form-group">
															<label class="label" for="txtQtdPessoas">Quantidade de Pessoas</label>
															<input id="txtQtdPessoas" class="form-control form-control-xs" type="number" />
														</div>
													</div>
												</div>
												<div class="row g-3 mb-3">
													<div class="col-md-12">
														<div class="form-group">
															<label class="label" for="txtDescricaoEvento">Descrição do Evento</label>
															<input id="txtDescricaoEvento" class="form-control form-control-xs" />
														</div>
													</div>
												</div>
												<div class="row g-3 mb-3">
													<div class="col-md-6">
														<div class="form-group">
															<label class="label" for="txtDataInicialEvento">Data Inicial</label>
															<input id="txtDataInicialEvento" class="form-control form-control-xs" type="date" />
														</div>
													</div>
													<div class="col-md-6">
														<div class="form-group">
															<label class="label" for="txtDataFinalEvento">Data Final</label>
															<input id="txtDataFinalEvento" class="form-control form-control-xs" type="date" />
														</div>
													</div>
												</div>
												<!-- Requisitante Evento -->
												<div class="row g-3 mb-3">
													<div class="col-md-6">
														<div class="form-group">
															<label class="label" for="lstRequisitanteEvento">Requisitante</label>
															<ejs-dropdowntree id="lstRequisitanteEvento"
																			  placeholder="Selecione um Requisitante"
																			  showCheckBox="false"
																			  allowMultiSelection="false"
																			  allowFiltering="true"
																			  filterType="Contains"
																			  filterBarPlaceholder="Procurar..."
																			  popupHeight="400px"
																			  change="RequisitanteEventoValueChange">
																<e-dropdowntree-fields dataSource="@ViewData["dataRequisitante"]" value="RequisitanteId" text="Requisitante"></e-dropdowntree-fields>
															</ejs-dropdowntree>
														</div>
													</div>
													<div class="col-md-6">
														<div class="form-group">
															<label class="label" for="lstSetorRequisitanteEvento">Setor do Requisitante</label>
															<ejs-dropdowntree id="lstSetorRequisitanteEvento"
																			  allowFiltering="true"
																			  placeholder="Selecione um Setor..."
																			  sortOrder="Ascending"
																			  showCheckBox="false"
																			  allowMultiSelection="false"
																			  filterType="Contains"
																			  filterBarPlaceholder="Procurar setor...">
																<e-dropdowntree-fields dataSource="@ViewData["dataSetor"]" value="SetorSolicitanteId" parentValue="SetorPaiId" hasChildren="HasChild" text="Nome" expanded="expanded"></e-dropdowntree-fields>
															</ejs-dropdowntree>
														</div>
													</div>
												</div>
												<div class="d-flex justify-content-end">
													<button id="btnInserirEvento" class="btn btn-primary mr-2" type="submit">Inserir Evento</button>
													<button type="button" class="btn btn-danger" id="btnFecharAccordionEvento">Fechar</button>
												</div>
											</form>
										</ng-template>
									</e-accordion-item>
								</e-accordion-items>
							</e-accordion>
						</div>
					</div>
				</div>
				<!-- ===================== FIM SEÇÃO EVENTO ===================== -->

				<!-- ===================== MOTORISTA, VEÍCULO, KM ======================== -->

				<div class="row align-items-end">
					<div class="col-4 col-md-4">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label id="lblMotorista" for="lstMotorista" class="label font-weight-bold mr-2" style="margin: 0;">Motorista</label>
								<i id="icoMotorista" class="fa-duotone fa-solid fa-person-biking" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<!-- Syncfusion ComboBox mantido -->
							<ejs-combobox id="lstMotorista"
										  placeholder="Selecione um Motorista"
										  allowFiltering="true"
										  filterType="Contains"
										  popupHeight="200px"
										  width="100%"
										  showClearButton="true"
										  dataSource="@ViewData["dataMotorista"]"
										  created="onLstMotoristaCreated"
										  change="MotoristaValueChange">
								<e-combobox-fields text="Nome" value="MotoristaId"></e-combobox-fields>
							</ejs-combobox>
						</div>
					</div>
					<div class="col-4 col-md-4">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label for="lstVeiculo" class="label mr-2 mb-0">Veículo</label>
								<i class="fa-duotone fa-solid fa-truck-bolt" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<!-- Syncfusion ComboBox mantido -->
							<ejs-combobox id="lstVeiculo" placeholder="Selecione um Veículo" allowFiltering="true" filterType="Contains" dataSource="@ViewData["dataVeiculo"]" popupHeight="200px" width="100%" showClearButton="true" change="VeiculoValueChange">
								<e-combobox-fields text="Descricao" value="VeiculoId"></e-combobox-fields>
							</ejs-combobox>
						</div>
					</div>
					<!-- Bloco de Km's agrupados lado a lado -->
					<div class="col-4 col-md-4 d-flex flex-wrap">
						<div class="form-group mr-2" id="divKmAtual">
							<label class="label">Km Atual</label>
							<i class="fa-duotone fa-solid fa-gauge" style="font-size: 1.25em; cursor: pointer;"></i>
							<input readonly id="txtKmAtual" class="form-control form-control-xs" />
						</div>
						<div class="form-group mr-2" id="divKmInicial">
							<label class="label">Km Inicial</label>
							<i class="fa-duotone fa-solid fa-gauge-max" style="font-size: 1.25em; cursor: pointer;"></i>
							<input id="txtKmInicial" class="form-control form-control-xs" />
						</div>
						<div class="form-group mr-2" id="divKmFinal">
							<label class="label">Km Final</label>
							<i class="fa-duotone fa-solid fa-gauge-min" style="font-size: 1.25em; cursor: pointer;"></i>
							<input id="txtKmFinal" class="form-control form-control-xs" />
						</div>
						<div class="form-group mr-2" id="divQuilometragem">
							<label class="label">Distância</label>
							<i class="fa-duotone fa-solid fa-road" style="font-size: 1.25em; cursor: pointer;"></i>
							<!-- Syncfusion NumericTextBox mantido -->
							<ejs-numerictextbox id="txtQuilometragem" Enabled="false" format="n0" Readonly="true" showSpinButton="false"></ejs-numerictextbox>
						</div>
					</div>
				</div>
				<!-- ===================== FIM MOTORISTA, VEÍCULO, KM ======================== -->
				<!-- ===================== COMBUSTÍVEL ========================= -->
				<div class="row align-items-end pb-3">
					<div class="col-6 col-md-3">
						<div class="form-group" id="divCombustivelInicial">
							<label class="label">Combustível Inicial</label>
							<i class="fa-duotone fa-solid fa-gauge-circle-plus" style="font-size: 1.25em; cursor: pointer;"></i>
							<ejs-dropdowntree id="ddtCombustivelInicial" popupHeight="200px" showClearButton="true">
								<e-dropdowntree-fields dataSource="@ViewData["dataCombustivel"]" value="Nivel" text="Descricao" imageURL="Imagem"></e-dropdowntree-fields>
							</ejs-dropdowntree>
						</div>
					</div>
					<div class="col-6 col-md-3">
						<div class="form-group" id="divCombustivelFinal">
							<label class="label">Combustível Final</label>
							<i class="fa-duotone fa-solid fa-gauge-circle-minus" style="font-size: 1.25em; cursor: pointer;"></i>
							<ejs-dropdowntree id="ddtCombustivelFinal" popupHeight="200px" showClearButton="true">
								<e-dropdowntree-fields dataSource="@ViewData["dataCombustivel"]" value="Nivel" text="Descricao" imageURL="Imagem"></e-dropdowntree-fields>
							</ejs-dropdowntree>
						</div>
					</div>
				</div>
				<!-- ===================== FIM COMBUSTÍVEL ========================= -->
				<!-- ===================== REQUISITANTE E SETOR ========================= -->
				<div class="row align-items-end">
					<!-- Bloco Requisitante com botão grudado -->
					<div class="col-md-6">
						<div class="form-group">
							<div class="d-flex align-items-end">
								<!-- ComboBox + botão colado -->
								<div style="flex:1;">
									<div class="d-flex flex-column ml-2">
										<div class="d-flex align-items-center mb-1">
											<label for="lstRequisitante" class="label font-weight-bold mr-2" style="margin: 0;">Requisitante</label>
											<i class="fa-duotone fa-solid fa-person-simple" style="font-size: 1.25em; cursor: pointer;"></i>
										</div>
										<div class="d-flex flex-row align-items-end" style="gap: 6px;">
											<!-- ComboBox Syncfusion mantido -->
											<ejs-combobox id="lstRequisitante" placeholder="Selecione um Requisitante..." allowFiltering="true" filterType="Contains" dataSource="@ViewData["dataRequisitante"]" popupHeight="200px" width="350px" showClearButton="true" change="RequisitanteValueChange">
												<e-combobox-fields text="Requisitante" value="RequisitanteId"></e-combobox-fields>
											</ejs-combobox>
											<!-- Botão grudado à direita -->
											<a class="btn btn-nfs ml-0" id="btnRequisitante"><i class="fal fa-user-plus"></i></a>
										</div>
									</div>
								</div>
								<!-- Ramal ao lado, alinhado em coluna -->
								<div class="d-flex flex-column ml-2">
									<div class="d-flex align-items-center mb-1">
										<label class="label font-weight-bold mr-2" style="margin: 0;">Ramal</label>
										<i class="fa-duotone fa-phone-office" style="font-size: 1.25em; cursor: pointer;"></i>
									</div>
									<input id="txtRamalRequisitante" class="form-control form-control-xs" style="width: 100%;" />
								</div>
							</div>
						</div>
						<!-- Accordion do Requisitante mantido -->
						<div id="accordionRequisitante" class="accordion-container-requisitante">
							<e-accordion>
								<e-accordion-items>
									<e-accordion-item expanded="true" header="Inserir um novo Requisitante">
										<ng-template #content>
											<form id="frmRequisitante">
												<div class="row g-3 mb-3">
													<div class="col-3">
														<div class="form-group">
															<label for="txtPonto">Ponto</label>
															<input type="text" id="txtPonto" class="form-control" />
														</div>
													</div>
													<div class="col-9">
														<div class="form-group">
															<label for="txtNome">Nome do Requisitante</label>
															<input type="text" id="txtNome" class="form-control" />
														</div>
													</div>
												</div>
												<div class="row g-3 mb-3">
													<div class="col-md-4">
														<div class="form-group">
															<label for="txtRamal">Ramal</label>
															<input type="text" id="txtRamal" class="form-control" />
														</div>
													</div>
													<div class="col-md-8">
														<div class="form-group">
															<label for="txtEmail">Email</label>
															<input type="email" id="txtEmail" class="form-control" />
														</div>
													</div>
												</div>
												<div class="form-group">
													<label for="ddtSetorRequisitante">Setor do Requisitante</label>
													<ejs-dropdowntree id="ddtSetorRequisitante" placeholder="Selecione um Setor"
																	  sortOrder="Ascending" allowFiltering="true" filterType="Contains"
																	  filterBarPlaceholder="Procurar..." width="100%" change="MotoristaValueChange">
														<e-dropdowntree-fields dataSource="@ViewData["dataSetor"]"
																			   value="SetorSolicitanteId" text="Nome"
																			   parentValue="SetorPaiId" hasChildren="HasChild">
														</e-dropdowntree-fields>
													</ejs-dropdowntree>
												</div>
												<div class="d-flex justify-content-end">
													<button id="btnInserirRequisitante" class="btn btn-primary mr-2" type="submit">
														Inserir Requisitante
													</button>
													<button type="button" class="btn btn-danger" id="btnFecharAccordionRequisitante">
														Fechar
													</button>
												</div>
											</form>
										</ng-template>
									</e-accordion-item>
								</e-accordion-items>
							</e-accordion>
						</div>
					</div>
					<!-- Bloco Setor do Requisitante -->
					<div class="col-md-6">
						<div class="form-group">
							<div class="d-flex align-items-end">
								<div class="flex-grow-1">
									<div class="d-flex flex-column ml-2">
										<div class="d-flex align-items-center mb-1">
											<label for="ddtSetor" class="label font-weight-bold mr-2" style="margin: 0;">Setor do Requisitante</label>
											<i class="fa-duotone fa-solid fa-building-user" style="font-size: 1.25em; cursor: pointer;"></i>
										</div>
										<!-- Syncfusion DropDownTree mantido -->
										<ejs-dropdowntree id="ddtSetor"
														  allowFiltering="true"
														  placeholder="Selecione um Setor..."
														  sortOrder="Ascending"
														  showCheckBox="false"
														  filterType="Contains"
														  filterBarPlaceholder="Procurar setor..."
														  width="100%">
											<e-dropdowntree-fields dataSource="@ViewData["dataSetor"]"
																   value="SetorSolicitanteId"
																   parentValue="SetorPaiId"
																   hasChildren="HasChild"
																   text="Nome"
																   expanded="expanded">
											</e-dropdowntree-fields>
										</ejs-dropdowntree>
									</div>
								</div>
							</div>
						</div>
						<!-- Accordion de Setor está comentado como no original -->
					</div>
				</div>
				<!-- ===================== FIM REQUISITANTE E SETOR ========================= -->
				
				<!-- ===================== RECORRÊNCIA (mantém todos controles/IDs) ===================== -->
				<div class="select-container" id="divRecorrencia">
					<!-- Recorrente Dropdown -->
					<div class="select-wrapper col-3">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label for="lstRecorrente" class="label mr-2 mb-0">Recorrente?</label>
								<i class="fa-duotone fa-solid fa-arrows-spin" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<input id="lstRecorrente" type="text" />
						</div>
					</div>

					<!-- Periodo Dropdown -->
					<div class="select-wrapper col-3" id="divPeriodo" style="display: none;">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label for="lstPeriodos" class="label mr-2 mb-0">Periodo</label>
								<i class="fa-duotone fa-solid fa-calendar-circle-exclamation" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<input id="lstPeriodos" type="text" />
						</div>
					</div>

					<!-- Periodo Texto (Input) -->
					<div class="select-wrapper col-3" id="divTxtPeriodo" style="display: none;">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label for="txtPeriodos" class="label mr-2 mb-0">Periodo</label>
								<i class="fa-duotone fa-solid fa-calendar-circle-exclamation" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<input type="text" id="txtPeriodos" class="form-control" disabled />
						</div>
					</div>

					<!-- Dias da Semana MultiSelect -->
					<div class="select-wrapper col-3" id="divDias" style="display: none;">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label for="lstDias" class="label mr-2 mb-0">Dias da Semana</label>
								<i class="fa-duotone fa-solid fa-calendar-week" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<input type="text" id="lstDias" />
						</div>
					</div>

					<!-- Dia do Mês Dropdown using Syncfusion -->
					<div class="select-wrapper col-2" id="divDiaMes" style="display: none;">
						<div class="d-flex flex-column ml-2">
							<div class="d-flex align-items-center mb-1">
								<label for="lstDiasMes" class="label mr-2 mb-0">Dia do Mês</label>
								<i class="fa-duotone fa-solid fa-calendar-clock" style="font-size: 1.25em; cursor: pointer;"></i>
							</div>
							<input id="lstDiasMes" />
						</div>
					</div>

					<!-- Data Final Recorrência (input abaixo do label) -->
					<div class="select-wrapper col-2" id="divFinalRecorrencia" style="display: none;">
						<label class="label">Data Final Recorrência</label>
						<input id="txtFinalRecorrencia" type="text" class="form-control" />
					</div>

					<!-- Data Final Falsa Input -->
					<div class="select-wrapper col-3" id="divFinalFalsoRecorrencia" style="display: none;">
						<label class="label">Data Final Recorrência</label>
						<div style="position: relative; display: inline-block;">
							<ejs-textbox id="txtDataFinalRecorrencia" cssClass="calendar-textbox"></ejs-textbox>
							<i class="fa-solid fa-calendar" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;"></i>
						</div>
					</div>

					<!-- Calendar Control -->
					<div class="calendar-container" id="calendarContainer" style="display: none;">
						<div id="calDatasSelecionadas"></div>
					</div>

					<!-- ListBox Container -->
					<div class="listbox-container" id="listboxContainer" style="display: none;">
						<span id="itensBadge" class="badge badge-overlay">0</span>
						<div class="card">
							<div class="card-header">Dias Selecionados</div>
							<div class="card-body">
								<div id="lstDiasCalendario"></div>
							</div>
						</div>
					</div>

					<!-- ListBox HTML Container -->
					<div id="listboxContainerHTML" style="display: none; border: 1px solid #ccc; width: 200px; padding: 10px;">
						<span id="itensBadgeHTML" class="badge badge-overlay" style="display: none">0</span>
						<div>
							<div id="divDiasSelecionados" style="font-weight: bold; margin-bottom: 10px; text-align: center;">
								Dias Selecionados
							</div>
							<div id="lstDiasCalendarioHTML" style="height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 5px;"></div>
						</div>
					</div>

				</div>
				<!-- ===================== FIM RECORRÊNCIA ===================== -->

				<br />
				<br />

				<!-- ===================== DESCRIÇÃO (mantido Syncfusion) ===================== -->
				<div class="row">
					<div class="col-md-12 col-xl-10 control-section">
						<div class="control-wrapper">
							<div class="d-flex flex-column ml-2">
								<div class="d-flex align-items-center mb-1">
									<label for="rteDescricao" class="label mr-2 mb-0">Descrição da Viagem (passageiros / carga)</label>
									<i class="fa-duotone fa-solid fa-typewriter" style="font-size: 1.25em; cursor: pointer;"></i>
								</div>
								<!-- Syncfusion RichTextEditor mantido -->
								<ejs-richtexteditor id="rteDescricao" toolbarClick="toolbarClick" locale="pt-BR" height="250px" created="onCreate">
									<e-richtexteditor-insertimagesettings saveUrl="api/Viagem/SaveImage" path="./DadosEditaveis/ImagensViagens/"></e-richtexteditor-insertimagesettings>
								</ejs-richtexteditor>
							</div>
						</div>
					</div>
				</div>

				<!-- ===================== REPORT ===================== -->
				<div style="height:200px; display: none;" id="ReportContainer">
					<div id="fichaReport" style="width:100%" class="pb-3">
						Carregando...
					</div>
				</div>

				<!-- ===================== USUÁRIOS ===================== -->
				<div class="row">
					<div class="col-12">
						<div class="form-group">
							<label id="lblUsuarioAgendamento" class="font-weight-light d-block text-muted">
								<i class="fa-duotone fa-solid fa-user-clock"></i> <span>Agendado por:</span>
							</label>
							<label id="lblUsuarioCriacao" class="font-weight-light d-block text-muted">
								<i class="fa-sharp-duotone fa-solid fa-user-plus"></i> <span>Criado por:</span>
							</label>
							<label id="lblUsuarioFinalizacao" class="font-weight-light d-block text-muted">
								<i class="fa-duotone fa-solid fa-user-check"></i> <span>Finalizado por:</span>
							</label>
							<label id="lblUsuarioCancelamento" class="font-weight-light d-block text-muted">
								<i class="fa-duotone fa-regular fa-trash-can-xmark"></i> <span>Cancelado por:</span>
							</label>
						</div>
					</div>
				</div>

				<!-- ===================== BOTÕES DO MODAL ===================== -->
				<div class="modal-footer" id="divBotoes">
					<button id="btnViagem" type="button" class="btn btn-sm fundo-laranja">
						<i class="fa-regular fa-shuffle" aria-hidden="true"></i>&nbsp;Transforma em Viagem
					</button>
					<button id="btnConfirma" type="button" class="btn btn-sm btn-primary">
						<i class="fa fa-save" aria-hidden="true"></i>Confirmar
					</button>
					<button id="btnApaga" type="button" class="btn btn-sm btn-danger">
						<i class="fa-light fa-trash-can-undo" aria-hidden="true"></i>Apagar
					</button>
					<button id="btnCancela" type="button" class="btn btn-sm btn-danger">
						<i class="fa fa-ban" aria-hidden="true"></i>Cancelar
					</button>
					<button id="btnFecha" type="button" class="btn btn-sm fundo-ebony" data-bs-dismiss="modal">
						<i class="fa fa-times" aria-hidden="true"></i>Fechar
					</button>
				</div>
				<!-- Todas as DIVs estão fechadas corretamente -->
			</div>
		</div>
	</div>
</div>
 *@




 @* -------------- Modal da Ficha da Viagem --------------
 ====================================================== *@
<form method="post" asp-action="Index" enctype="multipart/form-data">
	<div class="modal fade" id="modalPrint">
		<div class="modal-dialog modal-xl" role="document">

			<div class="modal-content">
				<div class="modal-header d-block">
					<h4 class="modal-title" id="DynamicModalLabel">Ficha do Agendamento</h4>
					<button id="btnFecharFicha" type="button" class="btn btn-danger" data-dismiss="modal">Fechar</button>
				</div>

				<div class="modal-body table-bordered container-fluid">

					<div class="row">
						<div class="col-xl-12">
							<div id="panel-1" class="panel">
								<div class="panel-container show">
									<div id="divPainel" class="panel-content">

										<div class="d-flex" style="height:700px" id="ReportContainer">
											<div id="reportViewer1" style="width:100%" class="pb-3">
												Carregando...
											</div>
										</div>

									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="modal-footer">
					</div>
				</div>
			</div>
		</div>
	</div>
</form>

@section ScriptsBlock
{
	<link href="https://cdn.kendostatic.com/2022.1.412/styles/kendo.default-main.min.css" rel="stylesheet" type="text/css" />
	<script src="https://cdn.kendostatic.com/2022.1.412/js/jszip.min.js"></script>
	<script src="https://cdn.kendostatic.com/2022.1.412/js/kendo.all.min.js"></script>
	<script src="https://cdn.kendostatic.com/2022.1.412/js/kendo.aspnetmvc.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.2.2/pdf.js"></script>
	<script>
		window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.2.2/pdf.worker.js';
	</script>

	<script src="/api/reports/resources/js/telerikReportViewer"></script>

	@*<script src="https://code.jquery.com/jquery-3.5.1.js"></script>*@
	<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

	<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js'></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.10/index.global.js" integrity="sha512-zAadCzZHXo/f5A/3uhF50bZXahdYNqisNgKKniyoJJVpp27b2bR82N4hPLGj3/qBEh3tGZ9SYGmSA1jpdtNF5A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<script src="~/lib/fullcalendar/locales-all.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.2/moment.min.js"></script>
	<script src="/api/reports/resources/js/telerikReportViewer-18.1.24.514.min.js"></script>
	<script type="module" src="/js/cadastros/agendamento_viagem_v1169.js"></script>
}
